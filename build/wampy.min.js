!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function f(a){if(l===setTimeout)return setTimeout(a,0);if((l===d||!l)&&setTimeout)return l=setTimeout,setTimeout(a,0);try{return l(a,0)}catch(b){try{return l.call(null,a,0)}catch(b){return l.call(this,a,0)}}}function g(a){if(m===clearTimeout)return clearTimeout(a);if((m===e||!m)&&clearTimeout)return m=clearTimeout,clearTimeout(a);try{return m(a)}catch(b){try{return m.call(null,a)}catch(b){return m.call(this,a)}}}function h(){q&&o&&(q=!1,o.length?p=o.concat(p):r=-1,p.length&&i())}function i(){if(!q){var a=f(h);q=!0;for(var b=p.length;b;){for(o=p,p=[];++r<b;)o&&o[r].run();r=-1,b=p.length}o=null,q=!1,g(a)}}function j(a,b){this.fun=a,this.array=b}function k(){}var l,m,n=b.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:d}catch(a){l=d}try{m="function"==typeof clearTimeout?clearTimeout:e}catch(a){m=e}}();var o,p=[],q=!1,r=-1;n.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];p.push(new j(a,b)),1!==p.length||q||f(i)},j.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=k,n.addListener=k,n.once=k,n.off=k,n.removeListener=k,n.removeAllListeners=k,n.emit=k,n.binding=function(a){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(a){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},{}],2:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();c.JsonCoder=function(){function a(){d(this,a),this.protocol="json"}return e(a,[{key:"encode",value:function(a){return JSON.stringify(a)}},{key:"decode",value:function(a){return JSON.parse(a)}}]),a}()},{}],3:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();c.MsgpackCoder=function(){function a(b){d(this,a),this.protocol="msgpack",this._msgpack=b}return e(a,[{key:"encode",value:function(a){return this._msgpack.encode(a)}},{key:"decode",value:function(a){return this._msgpack.decode(new Uint8Array(a))}}]),a}()},{}],4:[function(a,b,c){(function(a){"use strict";Object.defineProperty(c,"__esModule",{value:!0});var b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};c.WAMP_MSG_SPEC={HELLO:1,WELCOME:2,ABORT:3,CHALLENGE:4,AUTHENTICATE:5,GOODBYE:6,ERROR:8,PUBLISH:16,PUBLISHED:17,SUBSCRIBE:32,SUBSCRIBED:33,UNSUBSCRIBE:34,UNSUBSCRIBED:35,EVENT:36,CALL:48,CANCEL:49,RESULT:50,REGISTER:64,REGISTERED:65,UNREGISTER:66,UNREGISTERED:67,INVOCATION:68,INTERRUPT:69,YIELD:70},c.WAMP_ERROR_MSG={SUCCESS:{code:0,description:"Success!"},URI_ERROR:{code:1,description:"Topic URI doesn't meet requirements!"},NO_BROKER:{code:2,description:"Server doesn't provide broker role!"},NO_CALLBACK_SPEC:{code:3,description:"No required callback function specified!"},INVALID_PARAM:{code:4,description:"Invalid parameter(s) specified!"},NON_EXIST_UNSUBSCRIBE:{code:7,description:"Trying to unsubscribe from non existent subscription!"},NO_DEALER:{code:12,description:"Server doesn't provide dealer role!"},RPC_ALREADY_REGISTERED:{code:15,description:"RPC already registered!"},NON_EXIST_RPC_UNREG:{code:17,description:"Received rpc unregistration for non existent rpc!"},NON_EXIST_RPC_INVOCATION:{code:19,description:"Received invocation for non existent rpc!"},NON_EXIST_RPC_REQ_ID:{code:20,description:"No RPC calls in action with specified request ID!"},NO_REALM:{code:21,description:"No realm specified!"},NO_WS_OR_URL:{code:22,description:"No websocket provided or URL specified is incorrect!"},NO_CRA_CB_OR_ID:{code:23,description:"No onChallenge callback or authid was provided for authentication!"},CRA_EXCEPTION:{code:24,description:"Exception raised during CRA challenge processing"}},c.isNode="object"===(void 0===a?"undefined":b(a))&&"[object process]"===Object.prototype.toString.call(a)}).call(this,a("_process"))},{_process:1}],5:[function(a,b,c){"use strict";var d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},e=a("./wampy");!function(a){"undefined"!=typeof window&&(window.Wampy=a()),"function"==typeof define&&define.amd?define(["exports"],a):"object"===(void 0===c?"undefined":d(c))&&"string"!=typeof c.nodeName&&(b.exports=a())}(function(){return e.Wampy})},{"./wampy":7}],6:[function(a,b,c){"use strict";function d(a){var b=void 0,c=void 0;return/^ws(s)?:\/\//.test(a)?a:(b="https:"===window.location.protocol?"wss://":"ws://",a?"/"===a[0]?(c=""!==window.location.port?":"+window.location.port:"",b+window.location.hostname+c+a):b+a:(c=""!==window.location.port?":"+window.location.port:"",b+window.location.hostname+c+"/ws"))}function e(a){return/^ws(s)?:\/\//.test(a)?a:null}function f(a,b,c){var f=g.isNode?e(a):d(a);return f?c?new c(f,b):g.isNode?null:"WebSocket"in window?new window.WebSocket(f,b):"MozWebSocket"in window?new window.MozWebSocket(f,b):null:null}Object.defineProperty(c,"__esModule",{value:!0}),c.getWebSocket=f;var g=a("./constants")},{"./constants":4}],7:[function(a,b,c){(function(b){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0}),c.Wampy=void 0;var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a("./constants"),g=a("./utils"),h=a("./coder/JsonCoder"),i=a("./coder/MsgpackCoder");c.Wampy=function(){function a(b,c){d(this,a),this.version="v4.1.0",this._url="string"==typeof b?b:null,this._protocols=["wamp.2.json"],this._wamp_features={agent:"Wampy.js "+this.version,roles:{publisher:{features:{subscriber_blackwhite_listing:!0,publisher_exclusion:!0,publisher_identification:!0}},subscriber:{},caller:{features:{caller_identification:!0,progressive_call_results:!0,call_canceling:!0,call_timeout:!0}},callee:{features:{caller_identification:!0}}}},this._cache={sessionId:null,server_wamp_features:{roles:{}},isSayingGoodbye:!1,opStatus:{code:0,description:"Success!",reqId:0},timer:null,reconnectingAttempts:0},this._ws=null,this._wsQueue=[],this._requests={},this._calls={},this._subscriptions={},this._subsTopics=new Set,this._rpcRegs={},this._rpcNames=new Set,this._options={debug:!1,autoReconnect:!0,reconnectInterval:2e3,maxRetries:25,transportEncoding:"json",realm:null,helloCustomDetails:null,authid:null,authmethods:[],onChallenge:null,onConnect:null,onClose:null,onError:null,onReconnect:null,onReconnectSuccess:null,ws:null,coder:new a.JsonCoder},this._isPlainObject(c)?this._options=this._merge(this._options,c):this._isPlainObject(b)&&(this._options=this._merge(this._options,b)),this.connect()}return e(a,null,[{key:"JsonCoder",get:function(){return h.JsonCoder}},{key:"MsgpackCoder",get:function(){return i.MsgpackCoder}}]),e(a,[{key:"_log",value:function(){this._options.debug}},{key:"_getReqId",value:function(){var a=void 0;do a=Math.floor(55*Math.random());while(a in this._requests);return a}},{key:"_merge",value:function(){var a={},b=arguments.length,c=void 0,d=void 0;for(c=0;c<b;c++)for(d in arguments[c])a[d]=arguments[c][d];return a}},{key:"_isArray",value:function(a){return!!a&&Array.isArray(a)}},{key:"_isPlainObject",value:function(a){return!!a&&a.constructor===Object}},{key:"_setWsProtocols",value:function(){this._options.coder instanceof h.JsonCoder||this._protocols.unshift("wamp.2."+this._options.coder.protocol)}},{key:"_preReqChecks",value:function(a,b,c){var d=!0;return this._cache.sessionId&&!this._cache.server_wamp_features.roles[b]&&(this._cache.opStatus=f.WAMP_ERROR_MSG["NO_"+b.toUpperCase()],d=!1),a&&!this._validateURI(a)&&(this._cache.opStatus=f.WAMP_ERROR_MSG.URI_ERROR,d=!1),!!d||(this._isPlainObject(c)&&c.onError&&c.onError(this._cache.opStatus.description),!1)}},{key:"_validateURI",value:function(a){return!(!/^([0-9a-zA-Z_]{2,}\.)*([0-9a-zA-Z_]{2,})$/.test(a)||0===a.indexOf("wamp"))}},{key:"_encode",value:function(a){try{return this._options.coder.encode(a)}catch(a){throw new Error("[wampy] encoding exception!")}}},{key:"_decode",value:function(a){try{return this._options.coder.decode(a)}catch(a){throw new Error("[wampy] decoding exception!")}}},{key:"_send",value:function(a){if(a&&this._wsQueue.push(this._encode(a)),this._ws&&1===this._ws.readyState&&this._cache.sessionId)for(;this._wsQueue.length;)this._ws.send(this._wsQueue.shift())}},{key:"_resetState",value:function(){this._wsQueue=[],this._subscriptions={},this._subsTopics=new Set,this._requests={},this._calls={},this._rpcRegs={},this._rpcNames=new Set,this._cache={reconnectingAttempts:0}}},{key:"_initWsCallbacks",value:function(){var a=this;this._ws&&(this._ws.onopen=function(){a._wsOnOpen()},this._ws.onclose=function(b){a._wsOnClose(b)},this._ws.onmessage=function(b){a._wsOnMessage(b)},this._ws.onerror=function(b){a._wsOnError(b)})}},{key:"_wsOnOpen",value:function(){var a=this._merge(this._options.helloCustomDetails,this._wamp_features);this._options.authid&&(a.authmethods=this._options._authmethods,a.authid=this._options.authid),this._log("[wampy] websocket connected"),this._ws.protocol&&(this._options.transportEncoding=this._ws.protocol.split(".")[2]),"msgpack"===this._options.transportEncoding&&(this._ws.binaryType="arraybuffer"),this._ws.send(this._encode([f.WAMP_MSG_SPEC.HELLO,this._options.realm,a]))}},{key:"_wsOnClose",value:function(a){var c=this,d=f.isNode?b:window;this._log("[wampy] websocket disconnected. Info: ",a),(this._cache.sessionId||this._cache.reconnectingAttempts)&&this._options.autoReconnect&&this._cache.reconnectingAttempts<this._options.maxRetries&&!this._cache.isSayingGoodbye?(this._cache.sessionId=null,this._cache.timer=d.setTimeout(function(){c._wsReconnect()},this._options.reconnectInterval)):(this._options.onClose&&this._options.onClose(),this._resetState(),this._ws=null)}},{key:"_wsOnMessage",value:function(a){var b=this,c=void 0,d=void 0,e=void 0,g=void 0,h=void 0;switch(this._log("[wampy] websocket message received",a.data),c=this._decode(a.data),c[0]){case f.WAMP_MSG_SPEC.WELCOME:this._cache.sessionId=c[1],this._cache.server_wamp_features=c[2],this._cache.reconnectingAttempts?(this._cache.reconnectingAttempts=0,this._options.onReconnectSuccess&&this._options.onReconnectSuccess(),this._renewSubscriptions(),this._renewRegistrations()):this._options.onConnect&&this._options.onConnect(),this._send();break;case f.WAMP_MSG_SPEC.ABORT:this._options.onError&&this._options.onError(c[1].message?c[1].message:c[2]),this._ws.close();break;case f.WAMP_MSG_SPEC.CHALLENGE:this._options.authid&&"function"==typeof this._options.onChallenge?(h=new Promise(function(a,d){a(b._options.onChallenge(c[1],c[2]))}),h.then(function(a){b._ws.send(b._encode([f.WAMP_MSG_SPEC.AUTHENTICATE,a,{}]))}).catch(function(a){b._ws.send(b._encode([f.WAMP_MSG_SPEC.ABORT,{message:"Exception in onChallenge handler raised!"},"wamp.error.cannot_authenticate"])),b._options.onError&&b._options.onError(f.WAMP_ERROR_MSG.CRA_EXCEPTION.description),b._ws.close(),b._cache.opStatus=f.WAMP_ERROR_MSG.CRA_EXCEPTION})):(this._ws.send(this._encode([f.WAMP_MSG_SPEC.ABORT,{message:f.WAMP_ERROR_MSG.NO_CRA_CB_OR_ID.description},"wamp.error.cannot_authenticate"])),this._options.onError&&this._options.onError(f.WAMP_ERROR_MSG.NO_CRA_CB_OR_ID.description),this._ws.close(),this._cache.opStatus=f.WAMP_ERROR_MSG.NO_CRA_CB_OR_ID);break;case f.WAMP_MSG_SPEC.GOODBYE:this._cache.isSayingGoodbye||(this._cache.isSayingGoodbye=!0,this._send([f.WAMP_MSG_SPEC.GOODBYE,{},"wamp.error.goodbye_and_out"])),this._cache.sessionId=null,this._ws.close();break;case f.WAMP_MSG_SPEC.ERROR:switch(c[1]){case f.WAMP_MSG_SPEC.SUBSCRIBE:case f.WAMP_MSG_SPEC.UNSUBSCRIBE:case f.WAMP_MSG_SPEC.PUBLISH:case f.WAMP_MSG_SPEC.REGISTER:case f.WAMP_MSG_SPEC.UNREGISTER:this._requests[c[2]]&&this._requests[c[2]].callbacks.onError&&this._requests[c[2]].callbacks.onError(c[4],c[3],c[5],c[6]),delete this._requests[c[2]];break;case f.WAMP_MSG_SPEC.INVOCATION:break;case f.WAMP_MSG_SPEC.CALL:this._calls[c[2]]&&this._calls[c[2]].onError&&this._calls[c[2]].onError(c[4],c[3],c[5],c[6]),delete this._calls[c[2]];break;default:this._log("[wampy] Received non-compliant WAMP ERROR message")}break;case f.WAMP_MSG_SPEC.SUBSCRIBED:this._requests[c[1]]&&(this._subscriptions[this._requests[c[1]].topic]=this._subscriptions[c[2]]={id:c[2],callbacks:[this._requests[c[1]].callbacks.onEvent]},this._subsTopics.add(this._requests[c[1]].topic),this._requests[c[1]].callbacks.onSuccess&&this._requests[c[1]].callbacks.onSuccess(),delete this._requests[c[1]]);break;case f.WAMP_MSG_SPEC.UNSUBSCRIBED:this._requests[c[1]]&&(d=this._subscriptions[this._requests[c[1]].topic].id,delete this._subscriptions[this._requests[c[1]].topic],delete this._subscriptions[d],this._subsTopics.has(this._requests[c[1]].topic)&&this._subsTopics.delete(this._requests[c[1]].topic),this._requests[c[1]].callbacks.onSuccess&&this._requests[c[1]].callbacks.onSuccess(),delete this._requests[c[1]]);break;case f.WAMP_MSG_SPEC.PUBLISHED:this._requests[c[1]]&&(this._requests[c[1]].callbacks&&this._requests[c[1]].callbacks.onSuccess&&this._requests[c[1]].callbacks.onSuccess(),delete this._requests[c[1]]);break;case f.WAMP_MSG_SPEC.EVENT:if(this._subscriptions[c[1]])for(e=this._subscriptions[c[1]].callbacks.length;e--;)this._subscriptions[c[1]].callbacks[e](c[4],c[5]);break;case f.WAMP_MSG_SPEC.RESULT:this._calls[c[1]]&&(this._calls[c[1]].onSuccess(c[3],c[4]),c[2].progress&&c[2].progress===!0||delete this._calls[c[1]]);break;case f.WAMP_MSG_SPEC.REGISTERED:this._requests[c[1]]&&(this._rpcRegs[this._requests[c[1]].topic]=this._rpcRegs[c[2]]={id:c[2],callbacks:[this._requests[c[1]].callbacks.rpc]},this._rpcNames.add(this._requests[c[1]].topic),this._requests[c[1]].callbacks&&this._requests[c[1]].callbacks.onSuccess&&this._requests[c[1]].callbacks.onSuccess(),delete this._requests[c[1]]);break;case f.WAMP_MSG_SPEC.UNREGISTERED:this._requests[c[1]]&&(d=this._rpcRegs[this._requests[c[1]].topic].id,delete this._rpcRegs[this._requests[c[1]].topic],delete this._rpcRegs[d],this._rpcNames.has(this._requests[c[1]].topic)&&this._rpcNames.delete(this._requests[c[1]].topic),this._requests[c[1]].callbacks&&this._requests[c[1]].callbacks.onSuccess&&this._requests[c[1]].callbacks.onSuccess(),delete this._requests[c[1]]);break;case f.WAMP_MSG_SPEC.INVOCATION:this._rpcRegs[c[2]]?(h=new Promise(function(a,d){a(b._rpcRegs[c[2]].callbacks[0](c[4],c[5],c[3]))}),h.then(function(a){g=[f.WAMP_MSG_SPEC.YIELD,c[1],{}],b._isArray(a)?(b._isPlainObject(a[0])&&(g[2]=a[0]),b._isArray(a[1])?g.push(a[1]):void 0!==a[1]&&g.push([a[1]]),b._isPlainObject(a[2])&&(3===g.length&&g.push([]),g.push(a[2]))):g=[f.WAMP_MSG_SPEC.YIELD,c[1],{}],b._send(g)}).catch(function(a){var d=[f.WAMP_MSG_SPEC.ERROR,f.WAMP_MSG_SPEC.INVOCATION,c[1],a.details||{},a.uri||"wamp.error.invocation_exception"];a.argsList&&b._isArray(a.argsList)&&d.push(a.argsList),a.argsDict&&b._isPlainObject(a.argsDict)&&(5===d.length&&d.push([]),d.push(a.argsDict)),b._send(d)})):(this._send([f.WAMP_MSG_SPEC.ERROR,f.WAMP_MSG_SPEC.INVOCATION,c[1],{},"wamp.error.no_such_procedure"]),this._cache.opStatus=f.WAMP_ERROR_MSG.NON_EXIST_RPC_INVOCATION);break;default:this._log("[wampy] Received non-compliant WAMP message")}}},{key:"_wsOnError",value:function(a){this._log("[wampy] websocket error"),this._options.onError&&this._options.onError(a)}},{key:"_wsReconnect",value:function(){this._log("[wampy] websocket reconnecting..."),this._options.onReconnect&&this._options.onReconnect(),this._cache.reconnectingAttempts++,this._ws=(0,g.getWebSocket)(this._url,this._protocols,this._options.ws),this._initWsCallbacks()}},{key:"_renewSubscriptions",value:function(){var a=void 0,b=this._subscriptions,c=this._subsTopics;this._subscriptions={},this._subsTopics=new Set;var d=!0,e=!1,f=void 0;try{for(var g,h=c[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value;for(a=b[i].callbacks.length;a--;)this.subscribe(i,b[i].callbacks[a])}}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}}},{key:"_renewRegistrations",value:function(){var a=this._rpcRegs,b=this._rpcNames;this._rpcRegs={},this._rpcNames=new Set;var c=!0,d=!1,e=void 0;try{for(var f,g=b[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value;this.register(h,{rpc:a[h].callbacks[0]})}}catch(a){d=!0,e=a}finally{try{!c&&g.return&&g.return()}finally{if(d)throw e}}}},{key:"options",value:function(a){return void 0===a?this._options:this._isPlainObject(a)?(this._options=this._merge(this._options,a),this):void 0}},{key:"getOpStatus",value:function(){return this._cache.opStatus}},{key:"getSessionId",value:function(){return this._cache.sessionId}},{key:"connect",value:function(a){if(a&&(this._url=a),this._options.realm){var b=(this._options.authid?1:0)+(this._isArray(this._options.authmethods)&&this._options.authmethods.length?1:0)+("function"==typeof this._options.onChallenge?1:0);if(b>0&&b<3)return this._cache.opStatus=f.WAMP_ERROR_MSG.NO_CRA_CB_OR_ID,this;if(this._setWsProtocols(),this._ws=(0,g.getWebSocket)(this._url,this._protocols,this._options.ws),!this._ws)return this._cache.opStatus=f.WAMP_ERROR_MSG.NO_WS_OR_URL,this;this._initWsCallbacks()}else this._cache.opStatus=f.WAMP_ERROR_MSG.NO_REALM;return this}},{key:"disconnect",value:function(){return this._cache.sessionId?(this._cache.isSayingGoodbye=!0,this._send([f.WAMP_MSG_SPEC.GOODBYE,{},"wamp.error.system_shutdown"])):this._ws&&this._ws.close(),this._cache.opStatus=f.WAMP_ERROR_MSG.SUCCESS,this}},{key:"abort",value:function(){return this._cache.sessionId||1!==this._ws.readyState||(this._send([f.WAMP_MSG_SPEC.ABORT,{},"wamp.error.abort"]),this._cache.sessionId=null),this._ws.close(),this._cache.opStatus=f.WAMP_ERROR_MSG.SUCCESS,this}},{key:"subscribe",value:function(a,b){var c=void 0;if(!this._preReqChecks(a,"broker",b))return this;if("function"==typeof b)b={onEvent:b};else if(!this._isPlainObject(b)||void 0===b.onEvent)return this._cache.opStatus=f.WAMP_ERROR_MSG.NO_CALLBACK_SPEC,this._isPlainObject(b)&&b.onError&&b.onError(this._cache.opStatus.description),this;return this._subscriptions[a]&&this._subscriptions[a].callbacks.length?(this._subscriptions[a].callbacks.indexOf(b.onEvent)<0&&this._subscriptions[a].callbacks.push(b.onEvent),b.onSuccess&&b.onSuccess()):(c=this._getReqId(),this._requests[c]={topic:a,callbacks:b},this._send([f.WAMP_MSG_SPEC.SUBSCRIBE,c,{},a])),this._cache.opStatus=f.WAMP_ERROR_MSG.SUCCESS,this._cache.opStatus.reqId=c,this}},{key:"unsubscribe",value:function(a,b){var c=void 0,d=-1;return this._preReqChecks(null,"broker",b)?this._subscriptions[a]?(c=this._getReqId(),void 0===b?(this._subscriptions[a].callbacks=[],b={}):"function"==typeof b?(d=this._subscriptions[a].callbacks.indexOf(b),b={}):b.onEvent&&"function"==typeof b.onEvent?d=this._subscriptions[a].callbacks.indexOf(b.onEvent):this._subscriptions[a].callbacks=[],d>=0&&this._subscriptions[a].callbacks.splice(d,1),this._subscriptions[a].callbacks.length?(this._cache.opStatus=f.WAMP_ERROR_MSG.SUCCESS,this):(this._requests[c]={topic:a,callbacks:b},this._send([f.WAMP_MSG_SPEC.UNSUBSCRIBE,c,this._subscriptions[a].id]),this._cache.opStatus=f.WAMP_ERROR_MSG.SUCCESS,this._cache.opStatus.reqId=c,this)):(this._cache.opStatus=f.WAMP_ERROR_MSG.NON_EXIST_UNSUBSCRIBE,this._isPlainObject(b)&&b.onError&&b.onError(this._cache.opStatus.description),this):this}},{key:"publish",value:function(a,b,c,d){var e=void 0,g=void 0,h=!1,i={};if(!this._preReqChecks(a,"broker",c))return this;if(this._isPlainObject(c)&&(i.acknowledge=!0),void 0!==d&&(this._isPlainObject(d)?(d.exclude&&(this._isArray(d.exclude)&&d.exclude.length?i.exclude=d.exclude:"number"==typeof d.exclude?i.exclude=[d.exclude]:h=!0),d.exclude_authid&&(this._isArray(d.exclude_authid)&&d.exclude_authid.length?i.exclude_authid=d.exclude_authid:"string"==typeof d.exclude_authid?i.exclude_authid=[d.exclude_authid]:h=!0),d.exclude_authrole&&(this._isArray(d.exclude_authrole)&&d.exclude_authrole.length?i.exclude_authrole=d.exclude_authrole:"string"==typeof d.exclude_authrole?i.exclude_authrole=[d.exclude_authrole]:h=!0),d.eligible&&(this._isArray(d.eligible)&&d.eligible.length?i.eligible=d.eligible:"number"==typeof d.eligible?i.eligible=[d.eligible]:h=!0),d.eligible_authid&&(this._isArray(d.eligible_authid)&&d.eligible_authid.length?i.eligible_authid=d.eligible_authid:"string"==typeof d.eligible_authid?i.eligible_authid=[d.eligible_authid]:h=!0),d.eligible_authrole&&(this._isArray(d.eligible_authrole)&&d.eligible_authrole.length?i.eligible_authrole=d.eligible_authrole:"string"==typeof d.eligible_authrole?i.eligible_authrole=[d.eligible_authrole]:h=!0),d.hasOwnProperty("exclude_me")&&(i.exclude_me=d.exclude_me!==!1),d.hasOwnProperty("disclose_me")&&(i.disclose_me=d.disclose_me===!0)):h=!0,h))return this._cache.opStatus=f.WAMP_ERROR_MSG.INVALID_PARAM,this._isPlainObject(c)&&c.onError&&c.onError(this._cache.opStatus.description),this;switch(e=this._getReqId(),arguments.length){case 1:g=[f.WAMP_MSG_SPEC.PUBLISH,e,i,a];break;case 2:g=this._isArray(b)?[f.WAMP_MSG_SPEC.PUBLISH,e,i,a,b]:this._isPlainObject(b)?[f.WAMP_MSG_SPEC.PUBLISH,e,i,a,[],b]:[f.WAMP_MSG_SPEC.PUBLISH,e,i,a,[b]];break;default:this._requests[e]={topic:a,callbacks:c},g=this._isArray(b)?[f.WAMP_MSG_SPEC.PUBLISH,e,i,a,b]:this._isPlainObject(b)?[f.WAMP_MSG_SPEC.PUBLISH,e,i,a,[],b]:[f.WAMP_MSG_SPEC.PUBLISH,e,i,a,[b]]}return this._send(g),this._cache.opStatus=f.WAMP_ERROR_MSG.SUCCESS,this._cache.opStatus.reqId=e,this}},{key:"call",value:function(a,b,c,d){var e=void 0,g=void 0,h=!1,i={};if(!this._preReqChecks(a,"dealer",c))return this;if("function"==typeof c)c={onSuccess:c};else if(!this._isPlainObject(c)||void 0===c.onSuccess)return this._cache.opStatus=f.WAMP_ERROR_MSG.NO_CALLBACK_SPEC,this._isPlainObject(c)&&c.onError&&c.onError(this._cache.opStatus.description),this;if(void 0!==d&&(this._isPlainObject(d)?(d.hasOwnProperty("disclose_me")&&(i.disclose_me=d.disclose_me===!0),d.hasOwnProperty("receive_progress")&&(i.receive_progress=d.receive_progress===!0),d.hasOwnProperty("timeout")&&("number"==typeof d.timeout?i.timeout=d.timeout:h=!0)):h=!0,h))return this._cache.opStatus=f.WAMP_ERROR_MSG.INVALID_PARAM,this._isPlainObject(c)&&c.onError&&c.onError(this._cache.opStatus.description),this;do e=this._getReqId();while(e in this._calls);return this._calls[e]=c,g=null===b?[f.WAMP_MSG_SPEC.CALL,e,i,a]:this._isArray(b)?[f.WAMP_MSG_SPEC.CALL,e,i,a,b]:this._isPlainObject(b)?[f.WAMP_MSG_SPEC.CALL,e,i,a,[],b]:[f.WAMP_MSG_SPEC.CALL,e,i,a,[b]],this._send(g),this._cache.opStatus=f.WAMP_ERROR_MSG.SUCCESS,this._cache.opStatus.reqId=e,this}},{key:"cancel",value:function(a,b,c){var d={mode:"skip"};return this._preReqChecks(null,"dealer",b)?a&&this._calls[a]?(void 0!==c&&this._isPlainObject(c)&&c.hasOwnProperty("mode")&&(d.mode=/skip|kill|killnowait/.test(c.mode)?c.mode:"skip"),this._send([f.WAMP_MSG_SPEC.CANCEL,a,d]),this._cache.opStatus=f.WAMP_ERROR_MSG.SUCCESS,this._cache.opStatus.reqId=a,b.onSuccess&&b.onSuccess(),this):(this._cache.opStatus=f.WAMP_ERROR_MSG.NON_EXIST_RPC_REQ_ID,this._isPlainObject(b)&&b.onError&&b.onError(this._cache.opStatus.description),this):this}},{key:"register",value:function(a,b){var c=void 0;if(!this._preReqChecks(a,"dealer",b))return this;if("function"==typeof b)b={rpc:b};else if(!this._isPlainObject(b)||void 0===b.rpc)return this._cache.opStatus=f.WAMP_ERROR_MSG.NO_CALLBACK_SPEC,this._isPlainObject(b)&&b.onError&&b.onError(this._cache.opStatus.description),this;return this._rpcRegs[a]&&this._rpcRegs[a].callbacks.length?(this._cache.opStatus=f.WAMP_ERROR_MSG.RPC_ALREADY_REGISTERED,this._isPlainObject(b)&&b.onError&&b.onError(this._cache.opStatus.description)):(c=this._getReqId(),this._requests[c]={topic:a,callbacks:b},this._send([f.WAMP_MSG_SPEC.REGISTER,c,{},a]),this._cache.opStatus=f.WAMP_ERROR_MSG.SUCCESS,this._cache.opStatus.reqId=c),this}},{key:"unregister",value:function(a,b){var c=void 0;return this._preReqChecks(a,"dealer",b)?("function"==typeof b&&(b={onSuccess:b}),this._rpcRegs[a]?(c=this._getReqId(),this._requests[c]={topic:a,callbacks:b},this._send([f.WAMP_MSG_SPEC.UNREGISTER,c,this._rpcRegs[a].id]),this._cache.opStatus=f.WAMP_ERROR_MSG.SUCCESS,this._cache.opStatus.reqId=c):(this._cache.opStatus=f.WAMP_ERROR_MSG.NON_EXIST_RPC_UNREG,this._isPlainObject(b)&&b.onError&&b.onError(this._cache.opStatus.description)),this):this}}]),a}()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./coder/JsonCoder":2,"./coder/MsgpackCoder":3,"./constants":4,"./utils":6}]},{},[5]);
//# sourceMappingURL=wampy.min.js.map