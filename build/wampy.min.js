"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a};!function(a,b){"function"==typeof define&&define.amd?define(["exports"],b()):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"string"!=typeof exports.nodeName?module.exports=b():a.Wampy=b()}(this,function(){function a(a){var b=void 0,c=void 0;return a?/^ws(s)?:\/\//.test(a)?a:/:\d{1,5}/.test(a)?(b="https:"===window.location.protocol?"wss://":"ws://",b+a):"/"===a[0]?(b="https:"===window.location.protocol?"wss://":"ws://",c=""!==window.location.port?":"+window.location.port:"",b+window.location.hostname+c+a):(b="https:"===window.location.protocol?"wss://":"ws://",b+a):(b="https:"===window.location.protocol?"wss://":"ws://",c=""!==window.location.port?":"+window.location.port:"",b+window.location.hostname+c+"/ws")}function b(a){return/^ws(s)?:\/\//.test(a)?a:null}function c(c,d,e){var g=f?b(c):a(c);return g?e?new e(g,d):f?null:"WebSocket"in window?new window.WebSocket(g,d):"MozWebSocket"in window?new window.MozWebSocket(g,d):null:null}var d={HELLO:1,WELCOME:2,ABORT:3,CHALLENGE:4,AUTHENTICATE:5,GOODBYE:6,ERROR:8,PUBLISH:16,PUBLISHED:17,SUBSCRIBE:32,SUBSCRIBED:33,UNSUBSCRIBE:34,UNSUBSCRIBED:35,EVENT:36,CALL:48,CANCEL:49,RESULT:50,REGISTER:64,REGISTERED:65,UNREGISTER:66,UNREGISTERED:67,INVOCATION:68,INTERRUPT:69,YIELD:70},e={SUCCESS:{code:0,description:"Success!"},URI_ERROR:{code:1,description:"Topic URI doesn't meet requirements!"},NO_BROKER:{code:2,description:"Server doesn't provide broker role!"},NO_CALLBACK_SPEC:{code:3,description:"No required callback function specified!"},INVALID_PARAM:{code:4,description:"Invalid parameter(s) specified!"},NON_EXIST_UNSUBSCRIBE:{code:7,description:"Trying to unsubscribe from non existent subscription!"},NO_DEALER:{code:12,description:"Server doesn't provide dealer role!"},RPC_ALREADY_REGISTERED:{code:15,description:"RPC already registered!"},NON_EXIST_RPC_UNREG:{code:17,description:"Received rpc unregistration for non existent rpc!"},NON_EXIST_RPC_INVOCATION:{code:19,description:"Received invocation for non existent rpc!"},NON_EXIST_RPC_REQ_ID:{code:20,description:"No RPC calls in action with specified request ID!"},NO_REALM:{code:21,description:"No realm specified!"},NO_WS_OR_URL:{code:22,description:"No websocket provided or URL specified is incorrect!"},NO_CRA_CB_OR_ID:{code:23,description:"No onChallenge callback or authid was provided for authentication!"},CRA_EXCEPTION:{code:24,description:"Exception raised during CRA challenge processing"}},f="object"===("undefined"==typeof process?"undefined":_typeof(process))&&"[object process]"===Object.prototype.toString.call(process),g=function(){function a(b,c){switch(_classCallCheck(this,a),this.version="v3.0.1",this._url="string"==typeof b?b:null,this._protocols=["wamp.2.json"],this._authmethods=["wampcra"],this._wamp_features={agent:"Wampy.js "+this.version,roles:{publisher:{features:{subscriber_blackwhite_listing:!0,publisher_exclusion:!0,publisher_identification:!0}},subscriber:{},caller:{features:{caller_identification:!0,progressive_call_results:!0,call_canceling:!0,call_timeout:!0}},callee:{features:{caller_identification:!0}}}},this._cache={sessionId:null,server_wamp_features:{roles:{}},isSayingGoodbye:!1,opStatus:{code:0,description:"Success!",reqId:0},timer:null,reconnectingAttempts:0},this._ws=null,this._wsQueue=[],this._requests={},this._calls={},this._subscriptions={},this._subsTopics=new Set,this._rpcRegs={},this._rpcNames=new Set,this._options={debug:!1,autoReconnect:!0,reconnectInterval:2e3,maxRetries:25,transportEncoding:"json",realm:null,helloCustomDetails:null,onChallenge:null,authid:null,onConnect:null,onClose:null,onError:null,onReconnect:null,onReconnectSuccess:null,ws:null,msgpackCoder:null},arguments.length){case 1:"string"!=typeof arguments[0]&&(this._options=this._merge(this._options,arguments[0]));break;case 2:this._options=this._merge(this._options,c)}this.connect()}return _createClass(a,[{key:"_log",value:function(){this._options.debug}},{key:"_getReqId",value:function(){var a=void 0;do a=Math.floor(1e14*Math.random());while(a in this._requests);return a}},{key:"_merge",value:function(){var a={},b=void 0,c=arguments.length,d=void 0;for(b=0;c>b;b++)for(d in arguments[b])a[d]=arguments[b][d];return a}},{key:"_isArray",value:function(a){return!!a&&a.constructor===Array}},{key:"_isPlainObject",value:function(a){return!!a&&a.constructor===Object}},{key:"_setWsProtocols",value:function(){this._options.msgpackCoder&&("msgpack"===this._options.transportEncoding?this._protocols=["wamp.2.msgpack","wamp.2.json"]:this._protocols=["wamp.2.json","wamp.2.msgpack"])}},{key:"_validateURI",value:function(a){var b=/^([0-9a-zA-Z_]{2,}\.)*([0-9a-zA-Z_]{2,})$/;return!(!b.test(a)||0===a.indexOf("wamp"))}},{key:"_encode",value:function(a){if("msgpack"!==this._options.transportEncoding||!this._options.msgpackCoder)return JSON.stringify(a);try{return this._options.msgpackCoder.encode(a)}catch(b){throw new Error("[wampy] msgpack encode exception!")}}},{key:"_decode",value:function(a){if("msgpack"!==this._options.transportEncoding||!this._options.msgpackCoder)return JSON.parse(a);try{return this._options.msgpackCoder.decode(new Uint8Array(a))}catch(b){throw new Error("[wampy] msgpack decode exception!")}}},{key:"_send",value:function(a){if(a&&this._wsQueue.push(this._encode(a)),this._ws&&1===this._ws.readyState&&this._cache.sessionId)for(;this._wsQueue.length;)this._ws.send(this._wsQueue.shift())}},{key:"_resetState",value:function(){this._wsQueue=[],this._subscriptions={},this._subsTopics=new Set,this._requests={},this._calls={},this._rpcRegs={},this._rpcNames=new Set,this._cache={reconnectingAttempts:0}}},{key:"_initWsCallbacks",value:function(){var a=this;this._ws&&(this._ws.onopen=function(){a._wsOnOpen()},this._ws.onclose=function(b){a._wsOnClose(b)},this._ws.onmessage=function(b){a._wsOnMessage(b)},this._ws.onerror=function(b){a._wsOnError(b)})}},{key:"_wsOnOpen",value:function(){var a=this._merge(this._options.helloCustomDetails,this._wamp_features);this._options.authid&&(a.authmethods=this._authmethods,a.authid=this._options.authid),this._log("[wampy] websocket connected"),this._ws.protocol&&(this._options.transportEncoding=this._ws.protocol.split(".")[2]),"msgpack"===this._options.transportEncoding&&(this._ws.binaryType="arraybuffer"),this._ws.send(this._encode([d.HELLO,this._options.realm,a]))}},{key:"_wsOnClose",value:function(){var a=this,b=f?global:window;this._log("[wampy] websocket disconnected"),(this._cache.sessionId||this._cache.reconnectingAttempts)&&this._options.autoReconnect&&this._cache.reconnectingAttempts<this._options.maxRetries&&!this._cache.isSayingGoodbye?(this._cache.sessionId=null,this._cache.timer=b.setTimeout(function(){a._wsReconnect()},this._options.reconnectInterval)):(this._options.onClose&&this._options.onClose(),this._resetState(),this._ws=null)}},{key:"_wsOnMessage",value:function(a){var b=this,c=void 0,f=void 0,g=void 0,h=void 0,i=void 0,j=void 0;switch(this._log("[wampy] websocket message received",a.data),c=this._decode(a.data),c[0]){case d.WELCOME:this._cache.sessionId=c[1],this._cache.server_wamp_features=c[2],this._cache.reconnectingAttempts?(this._cache.reconnectingAttempts=0,this._options.onReconnectSuccess&&this._options.onReconnectSuccess(),this._renewSubscriptions(),this._renewRegistrations()):this._options.onConnect&&this._options.onConnect(),this._send();break;case d.ABORT:this._options.onError&&this._options.onError(c[1].message?c[1].message:c[2]),this._ws.close();break;case d.CHALLENGE:this._options.authid&&"function"==typeof this._options.onChallenge?(j=new Promise(function(a,d){a(b._options.onChallenge(c[1],c[2]))}),j.then(function(a){b._ws.send(b._encode([d.AUTHENTICATE,a,{}]))})["catch"](function(a){b._ws.send(b._encode([d.ABORT,{message:"Exception in onChallenge handler raised!"},"wamp.error.cannot_authenticate"])),b._options.onError&&b._options.onError(e.CRA_EXCEPTION.description),b._ws.close(),b._cache.opStatus=e.CRA_EXCEPTION})):(this._ws.send(this._encode([d.ABORT,{message:e.NO_CRA_CB_OR_ID.description},"wamp.error.cannot_authenticate"])),this._options.onError&&this._options.onError(e.NO_CRA_CB_OR_ID.description),this._ws.close(),this._cache.opStatus=e.NO_CRA_CB_OR_ID);break;case d.GOODBYE:this._cache.isSayingGoodbye||(this._cache.isSayingGoodbye=!0,this._send([d.GOODBYE,{},"wamp.error.goodbye_and_out"])),this._cache.sessionId=null,this._ws.close();break;case d.ERROR:switch(c[1]){case d.SUBSCRIBE:case d.UNSUBSCRIBE:this._requests[c[2]]&&(this._requests[c[2]].callbacks.onError&&this._requests[c[2]].callbacks.onError(c[4]),delete this._requests[c[2]]);break;case d.PUBLISH:this._requests[c[2]]&&(this._requests[c[2]].callbacks.onError&&this._requests[c[2]].callbacks.onError(c[4]),delete this._requests[c[2]]);break;case d.REGISTER:case d.UNREGISTER:this._requests[c[2]]&&(this._requests[c[2]].callbacks.onError&&this._requests[c[2]].callbacks.onError(c[4]),delete this._requests[c[2]]);break;case d.INVOCATION:break;case d.CALL:if(this._calls[c[2]]){if(this._calls[c[2]].onError){switch(c.length){case 5:h=null;break;case 6:h=c[5];break;case 7:h=c[6]}this._calls[c[2]].onError(h)}delete this._calls[c[2]]}}break;case d.SUBSCRIBED:this._requests[c[1]]&&(this._subscriptions[this._requests[c[1]].topic]=this._subscriptions[c[2]]={id:c[2],callbacks:[this._requests[c[1]].callbacks.onEvent]},this._subsTopics.add(this._requests[c[1]].topic),this._requests[c[1]].callbacks.onSuccess&&this._requests[c[1]].callbacks.onSuccess(),delete this._requests[c[1]]);break;case d.UNSUBSCRIBED:this._requests[c[1]]&&(f=this._subscriptions[this._requests[c[1]].topic].id,delete this._subscriptions[this._requests[c[1]].topic],delete this._subscriptions[f],this._subsTopics.has(this._requests[c[1]].topic)&&this._subsTopics["delete"](this._requests[c[1]].topic),this._requests[c[1]].callbacks.onSuccess&&this._requests[c[1]].callbacks.onSuccess(),delete this._requests[c[1]]);break;case d.PUBLISHED:this._requests[c[1]]&&(this._requests[c[1]].callbacks&&this._requests[c[1]].callbacks.onSuccess&&this._requests[c[1]].callbacks.onSuccess(),delete this._requests[c[1]]);break;case d.EVENT:if(this._subscriptions[c[1]]){switch(c.length){case 4:h=null;break;case 5:h=c[4];break;case 6:h=c[5]}for(g=this._subscriptions[c[1]].callbacks.length;g--;)this._subscriptions[c[1]].callbacks[g](h)}break;case d.RESULT:if(this._calls[c[1]]){switch(c.length){case 3:h=null;break;case 4:h=c[3];break;case 5:h=c[4]}this._calls[c[1]].onSuccess(h),c[2].progress&&c[2].progress===!0||delete this._calls[c[1]]}break;case d.REGISTER:break;case d.REGISTERED:this._requests[c[1]]&&(this._rpcRegs[this._requests[c[1]].topic]=this._rpcRegs[c[2]]={id:c[2],callbacks:[this._requests[c[1]].callbacks.rpc]},this._rpcNames.add(this._requests[c[1]].topic),this._requests[c[1]].callbacks&&this._requests[c[1]].callbacks.onSuccess&&this._requests[c[1]].callbacks.onSuccess(),delete this._requests[c[1]]);break;case d.UNREGISTER:break;case d.UNREGISTERED:this._requests[c[1]]&&(f=this._rpcRegs[this._requests[c[1]].topic].id,delete this._rpcRegs[this._requests[c[1]].topic],delete this._rpcRegs[f],this._rpcNames.has(this._requests[c[1]].topic)&&this._rpcNames["delete"](this._requests[c[1]].topic),this._requests[c[1]].callbacks&&this._requests[c[1]].callbacks.onSuccess&&this._requests[c[1]].callbacks.onSuccess(),delete this._requests[c[1]]);break;case d.INVOCATION:if(this._rpcRegs[c[2]]){switch(c.length){case 4:h=null;break;case 5:h=c[4];break;case 6:h=c[5]}j=new Promise(function(a,d){a(b._rpcRegs[c[2]].callbacks[0](h,c[3]))}),j.then(function(a){i=a?b._isArray(a[1])?[d.YIELD,c[1],a[0],a[1]]:b._isPlainObject(a[1])?[d.YIELD,c[1],a[0],[],a[1]]:"undefined"==typeof a[1]?[d.YIELD,c[1],a[0]]:[d.YIELD,c[1],a[0],[a[1]]]:[d.YIELD,c[1],{}],b._send(i)})["catch"](function(a){b._send([d.ERROR,d.INVOCATION,c[1],{},"wamp.error.invocation_exception"])})}else this._send([d.ERROR,d.INVOCATION,c[1],{},"wamp.error.no_such_procedure"]),this._cache.opStatus=e.NON_EXIST_RPC_INVOCATION;break;case d.INTERRUPT:break;case d.YIELD:}}},{key:"_wsOnError",value:function(a){this._log("[wampy] websocket error"),this._options.onError&&this._options.onError(a)}},{key:"_wsReconnect",value:function(){this._log("[wampy] websocket reconnecting..."),this._options.onReconnect&&this._options.onReconnect(),this._cache.reconnectingAttempts++,this._ws=c(this._url,this._protocols,this._options.ws),this._initWsCallbacks()}},{key:"_renewSubscriptions",value:function(){var a=this._subscriptions,b=this._subsTopics,c=void 0;this._subscriptions={},this._subsTopics=new Set;var d=!0,e=!1,f=void 0;try{for(var g,h=b[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value;for(c=a[i].callbacks.length;c--;)this.subscribe(i,a[i].callbacks[c])}}catch(j){e=!0,f=j}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}}},{key:"_renewRegistrations",value:function(){var a=this._rpcRegs,b=this._rpcNames;this._rpcRegs={},this._rpcNames=new Set;var c=!0,d=!1,e=void 0;try{for(var f,g=b[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value;this.register(h,{rpc:a[h].callbacks[0]})}}catch(i){d=!0,e=i}finally{try{!c&&g["return"]&&g["return"]()}finally{if(d)throw e}}}},{key:"options",value:function(a){return"undefined"==typeof a?this._options:this._isPlainObject(a)?(this._options=this._merge(this._options,a),this):void 0}},{key:"getOpStatus",value:function(){return this._cache.opStatus}},{key:"getSessionId",value:function(){return this._cache.sessionId}},{key:"connect",value:function(a){if(a&&(this._url=a),this._options.realm){if(!this._options.authid&&"function"==typeof this._options.onChallenge||this._options.authid&&"function"!=typeof this._options.onChallenge)return this._cache.opStatus=e.NO_CRA_CB_OR_ID,this;if(this._setWsProtocols(),this._ws=c(this._url,this._protocols,this._options.ws),!this._ws)return this._cache.opStatus=e.NO_WS_OR_URL,this;this._initWsCallbacks()}else this._cache.opStatus=e.NO_REALM;return this}},{key:"disconnect",value:function(){return this._cache.sessionId?(this._cache.isSayingGoodbye=!0,this._send([d.GOODBYE,{},"wamp.error.system_shutdown"])):this._ws&&this._ws.close(),this._cache.opStatus=e.SUCCESS,this}},{key:"abort",value:function(){return this._cache.sessionId||1!==this._ws.readyState||(this._send([d.ABORT,{},"wamp.error.abort"]),this._cache.sessionId=null),this._ws.close(),this._cache.opStatus=e.SUCCESS,this}},{key:"subscribe",value:function(a,b){var c=void 0;if(this._cache.sessionId&&!this._cache.server_wamp_features.roles.broker)return this._cache.opStatus=e.NO_BROKER,this._isPlainObject(b)&&b.onError&&b.onError(this._cache.opStatus.description),this;if(!this._validateURI(a))return this._cache.opStatus=e.URI_ERROR,this._isPlainObject(b)&&b.onError&&b.onError(this._cache.opStatus.description),this;if("function"==typeof b)b={onEvent:b};else if(!this._isPlainObject(b)||"undefined"==typeof b.onEvent)return this._cache.opStatus=e.NO_CALLBACK_SPEC,this._isPlainObject(b)&&b.onError&&b.onError(this._cache.opStatus.description),this;return this._subscriptions[a]&&this._subscriptions[a].callbacks.length?(this._subscriptions[a].callbacks.indexOf(b.onEvent)<0&&this._subscriptions[a].callbacks.push(b.onEvent),b.onSuccess&&b.onSuccess()):(c=this._getReqId(),this._requests[c]={topic:a,callbacks:b},this._send([d.SUBSCRIBE,c,{},a])),this._cache.opStatus=e.SUCCESS,this._cache.opStatus.reqId=c,this}},{key:"unsubscribe",value:function(a,b){var c=void 0,f=-1;return this._cache.sessionId&&!this._cache.server_wamp_features.roles.broker?(this._cache.opStatus=e.NO_BROKER,this._isPlainObject(b)&&b.onError&&b.onError(this._cache.opStatus.description),this):this._subscriptions[a]?(c=this._getReqId(),"undefined"==typeof b?(this._subscriptions[a].callbacks=[],b={}):"function"==typeof b?(f=this._subscriptions[a].callbacks.indexOf(b),b={}):b.onEvent&&"function"==typeof b.onEvent?f=this._subscriptions[a].callbacks.indexOf(b.onEvent):this._subscriptions[a].callbacks=[],f>=0&&this._subscriptions[a].callbacks.splice(f,1),this._subscriptions[a].callbacks.length?(this._cache.opStatus=e.SUCCESS,this):(this._requests[c]={topic:a,callbacks:b},this._send([d.UNSUBSCRIBE,c,this._subscriptions[a].id]),this._cache.opStatus=e.SUCCESS,this._cache.opStatus.reqId=c,this)):(this._cache.opStatus=e.NON_EXIST_UNSUBSCRIBE,this._isPlainObject(b)&&b.onError&&b.onError(this._cache.opStatus.description),this)}},{key:"publish",value:function(a,b,c,f){var g=void 0,h=void 0,i={},j=!1;if(this._cache.sessionId&&!this._cache.server_wamp_features.roles.broker)return this._cache.opStatus=e.NO_BROKER,this._isPlainObject(c)&&c.onError&&c.onError(this._cache.opStatus.description),this;if(!this._validateURI(a))return this._cache.opStatus=e.URI_ERROR,this._isPlainObject(c)&&c.onError&&c.onError(this._cache.opStatus.description),this;if(this._isPlainObject(c)&&(i.acknowledge=!0),"undefined"!=typeof f&&(this._isPlainObject(f)?(f.exclude&&(this._isArray(f.exclude)&&f.exclude.length?i.exclude=f.exclude:"number"==typeof f.exclude?i.exclude=[f.exclude]:j=!0),f.exclude_authid&&(this._isArray(f.exclude_authid)&&f.exclude_authid.length?i.exclude_authid=f.exclude_authid:"string"==typeof f.exclude_authid?i.exclude_authid=[f.exclude_authid]:j=!0),f.exclude_authrole&&(this._isArray(f.exclude_authrole)&&f.exclude_authrole.length?i.exclude_authrole=f.exclude_authrole:"string"==typeof f.exclude_authrole?i.exclude_authrole=[f.exclude_authrole]:j=!0),f.eligible&&(this._isArray(f.eligible)&&f.eligible.length?i.eligible=f.eligible:"number"==typeof f.eligible?i.eligible=[f.eligible]:j=!0),f.eligible_authid&&(this._isArray(f.eligible_authid)&&f.eligible_authid.length?i.eligible_authid=f.eligible_authid:"string"==typeof f.eligible_authid?i.eligible_authid=[f.eligible_authid]:j=!0),f.eligible_authrole&&(this._isArray(f.eligible_authrole)&&f.eligible_authrole.length?i.eligible_authrole=f.eligible_authrole:"string"==typeof f.eligible_authrole?i.eligible_authrole=[f.eligible_authrole]:j=!0),f.hasOwnProperty("exclude_me")&&(i.exclude_me=f.exclude_me!==!1),f.hasOwnProperty("disclose_me")&&(i.disclose_me=f.disclose_me===!0)):j=!0,j))return this._cache.opStatus=e.INVALID_PARAM,this._isPlainObject(c)&&c.onError&&c.onError(this._cache.opStatus.description),this;switch(g=this._getReqId(),arguments.length){case 1:h=[d.PUBLISH,g,i,a];break;case 2:h=this._isArray(b)?[d.PUBLISH,g,i,a,b]:this._isPlainObject(b)?[d.PUBLISH,g,i,a,[],b]:[d.PUBLISH,g,i,a,[b]];break;default:this._requests[g]={topic:a,callbacks:c},h=this._isArray(b)?[d.PUBLISH,g,i,a,b]:this._isPlainObject(b)?[d.PUBLISH,g,i,a,[],b]:[d.PUBLISH,g,i,a,[b]]}return this._send(h),this._cache.opStatus=e.SUCCESS,this._cache.opStatus.reqId=g,this}},{key:"call",value:function(a,b,c,f){var g=void 0,h=void 0,i={},j=!1;if(this._cache.sessionId&&!this._cache.server_wamp_features.roles.dealer)return this._cache.opStatus=e.NO_DEALER,this._isPlainObject(c)&&c.onError&&c.onError(this._cache.opStatus.description),this;if(!this._validateURI(a))return this._cache.opStatus=e.URI_ERROR,this._isPlainObject(c)&&c.onError&&c.onError(this._cache.opStatus.description),this;if("function"==typeof c)c={onSuccess:c};else if(!this._isPlainObject(c)||"undefined"==typeof c.onSuccess)return this._cache.opStatus=e.NO_CALLBACK_SPEC,this._isPlainObject(c)&&c.onError&&c.onError(this._cache.opStatus.description),this;if("undefined"!=typeof f&&(this._isPlainObject(f)?(f.hasOwnProperty("disclose_me")&&(i.disclose_me=f.disclose_me===!0),f.hasOwnProperty("receive_progress")&&(i.receive_progress=f.receive_progress===!0),f.hasOwnProperty("timeout")&&("number"==typeof f.timeout?i.timeout=f.timeout:j=!0)):j=!0,j))return this._cache.opStatus=e.INVALID_PARAM,this._isPlainObject(c)&&c.onError&&c.onError(this._cache.opStatus.description),this;do g=this._getReqId();while(g in this._calls);return this._calls[g]=c,h=null===b?[d.CALL,g,i,a]:this._isArray(b)?[d.CALL,g,i,a,b]:this._isPlainObject(b)?[d.CALL,g,i,a,[],b]:[d.CALL,g,i,a,[b]],this._send(h),this._cache.opStatus=e.SUCCESS,this._cache.opStatus.reqId=g,this}},{key:"cancel",value:function(a,b,c){var f={mode:"skip"};return this._cache.sessionId&&!this._cache.server_wamp_features.roles.dealer?(this._cache.opStatus=e.NO_DEALER,this._isPlainObject(b)&&b.onError&&b.onError(this._cache.opStatus.description),this):a&&this._calls[a]?("undefined"!=typeof c&&this._isPlainObject(c)&&c.hasOwnProperty("mode")&&(f.mode=/skip|kill|killnowait/.test(c.mode)?c.mode:"skip"),this._send([d.CANCEL,a,f]),b.onSuccess&&b.onSuccess(),this._cache.opStatus=e.SUCCESS,this._cache.opStatus.reqId=a,this):(this._cache.opStatus=e.NON_EXIST_RPC_REQ_ID,this._isPlainObject(b)&&b.onError&&b.onError(this._cache.opStatus.description),this)}},{key:"register",value:function(a,b){var c=void 0;if(this._cache.sessionId&&!this._cache.server_wamp_features.roles.dealer)return this._cache.opStatus=e.NO_DEALER,this._isPlainObject(b)&&b.onError&&b.onError(this._cache.opStatus.description),this;if(!this._validateURI(a))return this._cache.opStatus=e.URI_ERROR,this._isPlainObject(b)&&b.onError&&b.onError(this._cache.opStatus.description),this;if("function"==typeof b)b={rpc:b};else if(!this._isPlainObject(b)||"undefined"==typeof b.rpc)return this._cache.opStatus=e.NO_CALLBACK_SPEC,this._isPlainObject(b)&&b.onError&&b.onError(this._cache.opStatus.description),this;return this._rpcRegs[a]&&this._rpcRegs[a].callbacks.length?(this._cache.opStatus=e.RPC_ALREADY_REGISTERED,this._isPlainObject(b)&&b.onError&&b.onError(this._cache.opStatus.description)):(c=this._getReqId(),this._requests[c]={topic:a,callbacks:b},this._send([d.REGISTER,c,{},a]),this._cache.opStatus=e.SUCCESS,this._cache.opStatus.reqId=c),this}},{key:"unregister",value:function(a,b){var c=void 0;return this._cache.sessionId&&!this._cache.server_wamp_features.roles.dealer?(this._cache.opStatus=e.NO_DEALER,this._isPlainObject(b)&&b.onError&&b.onError(this._cache.opStatus.description),this):this._validateURI(a)?("function"==typeof b&&(b={onSuccess:b}),this._rpcRegs[a]?(c=this._getReqId(),this._requests[c]={topic:a,callbacks:b},this._send([d.UNREGISTER,c,this._rpcRegs[a].id]),this._cache.opStatus=e.SUCCESS,this._cache.opStatus.reqId=c):(this._cache.opStatus=e.NON_EXIST_RPC_UNREG,this._isPlainObject(b)&&b.onError&&b.onError(this._cache.opStatus.description)),this):(this._cache.opStatus=e.URI_ERROR,this._isPlainObject(b)&&b.onError&&b.onError(this._cache.opStatus.description),this)}}]),a}();return g});
//# sourceMappingURL=wampy.min.js.map